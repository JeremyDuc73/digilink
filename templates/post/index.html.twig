{% extends 'base.html.twig' %}

{% block title %}All posts{% endblock %}

{% block stylesheets %}
    {{ encore_entry_link_tags('post') }}
    {{ encore_entry_link_tags('app') }}
{% endblock %}

{% block javascripts %}
    {{ encore_entry_script_tags('post') }}
    {{ encore_entry_script_tags('app') }}
{% endblock %}

{% block body %}

    <button class="btn btn-secondary mt-3 mb-3" href="{{ path('new_post') }}">CREER UN POST</button>

    {% for post in posts %}

        <div class="card">
            <div class="top">
                <h2>{{ post.title }}</h2> <div class="three"></div>
            <h6>written by {{ post.author.firstName }}</h6>
            <h6>at {{ post.createdAt|date('H:s - d/m/Y') }}</h6>
            <p>{{ post.content }}</p>
            <div>
            <a href="{{ path("post_show", {id:post.id}) }}" class="btn btn-success">Voir</a>
            <a href="{{ path("repost", {id:post.id}) }}" class="btn btn-secondary">Repost</a>
            </div>
        </div>
        </div>

        <p><strong>
                <a href="{{ path('app_like', {id:post.id}) }}" class="btn like">
                   {#  <i class="thumb bi bi-hand-thumbs-up{% if post.postLikes(app.user.profile) %}-fill{% endif %}"></i>#}
                    <span class="nbrLikes">{{ post.Postlikes|length}}</span>
                </a>

            </strong></p>

    {% endfor %}
    <script>


        function like(event){
            event.preventDefault()

            fetch(this.href)
                .then(response=>response.json())
                .then((data)=>{
                    console.log(this)
                    this.querySelector('.nbrLikes').innerHTML = data.count
                    if(data.liked){
                        this.querySelector('.thumb').classList.remove('bi-hand-thumbs-up')
                        this.querySelector('.thumb').classList.add('bi-hand-thumbs-up-fill')

                    }else{
                        this.querySelector('.thumb').classList.remove('bi-hand-thumbs-up-fill')
                        this.querySelector('.thumb').classList.add('bi-hand-thumbs-up')


                    }
                })
        }

        document.addEventListener('DOMContentLoaded', ()=>{
            const boutonsLike = document.querySelectorAll('.like')

            boutonsLike.forEach((bouton)=>{
                bouton.addEventListener('click', like)
            })
        })


    </script>
{% endblock %}
